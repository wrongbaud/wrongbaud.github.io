<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Tricore Basics: Using the Hightec Tricore Toolchain in Linux" /><meta name="author" content="wrongbaud" /><meta property="og:locale" content="en_US" /><meta name="description" content="A blog focusing on hardware and software reverse engineering" /><meta property="og:description" content="A blog focusing on hardware and software reverse engineering" /><link rel="canonical" href="https://wrongbaud.github.io/posts/hightec-tricore-linux-ghidra/" /><meta property="og:url" content="https://wrongbaud.github.io/posts/hightec-tricore-linux-ghidra/" /><meta property="og:site_name" content="Wrongbaud’s Blog" /><meta property="og:image" content="https://wrongbaud.github.io/" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-08-04T08:20:10+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://wrongbaud.github.io/" /><meta property="twitter:title" content="Tricore Basics: Using the Hightec Tricore Toolchain in Linux" /><meta name="twitter:site" content="@wrongbaud" /><meta name="twitter:creator" content="@wrongbaud" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"A blog focusing on hardware and software reverse engineering","headline":"Tricore Basics: Using the Hightec Tricore Toolchain in Linux","dateModified":"2019-08-04T08:20:10+08:00","datePublished":"2019-08-04T08:20:10+08:00","@type":"BlogPosting","image":"https://wrongbaud.github.io/","url":"https://wrongbaud.github.io/posts/hightec-tricore-linux-ghidra/","mainEntityOfPage":{"@type":"WebPage","@id":"https://wrongbaud.github.io/posts/hightec-tricore-linux-ghidra/"},"author":{"@type":"Person","name":"wrongbaud"},"@context":"https://schema.org"}</script><title>Tricore Basics: Using the Hightec Tricore Toolchain in Linux | Wrongbaud's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="https://i2.wp.com/wasistdas.co.uk/Owlsploitation/wp-content/uploads/2011/05/bubo2.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Wrongbaud's Blog</a></div><div class="site-subtitle font-italic">Hardware / Software Reverse Engineering</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/wrongbaud" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wrongbaud" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['wrongbaud','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Tricore Basics: Using the Hightec Tricore Toolchain in Linux</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Tricore Basics: Using the Hightec Tricore Toolchain in Linux</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 4, 2019, 8:20 AM +0800" > Aug 4, 2019 <i class="unloaded">2019-08-04T08:20:10+08:00</i> </span> by <span class="author"> wrongbaud </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Nov 23, 2020, 1:24 AM -0500" > Nov 23, 2020 <i class="unloaded">2020-11-23T14:24:22+08:00</i> </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="" class="post-preview-img"><h1 id="background">Background</h1><p>The Tricore CPU architecture is commonly found in automotive embedded systems, often running an RTOS or even just bare metal firmware. This post will go over setting up an entry level toolchain for the Tricore architecture under Linux, and how we can use this toolchain when reverse engineering automotive platforms. We will also go over and provide a very simple bare metal loader.</p><p>This will be the first in a series of posts about the Tricore architecture and reverse engineering Tricore based embedded systems. For this series we’ll be targeting a Tricore 1767, which is an older but commonly used CPU in automotive systems.</p><p>In the past when reverse engineering and occasionally developing payloads I’ve written all of my Tricore code in ASM and never really explored the idea of using any available compilers. This series will explore these options and hopefully help some people out along the way…or at least entertain!</p><h1 id="goals">Goals</h1><ol><li>Setup HighTec Embedded toolchain under Linux (Ubuntu 18.04) using WINE.<li>Build a “Hello World” binary to toggle GPIO Lines perform very basic initialization routines<li>Disassemble/Decompile the binary using GHIDRA</ol><h2 id="a-very-brief-infineon-tricore-intro">A <em>very</em> brief Infineon Tricore Intro</h2><p>The Infineon Tricore architecture is a commonly used architecture in automotive embedded systems. It typically contains a RISC core, micro-controller and often a DSP package. There are 32 general purpose registers, Address: <code class="language-plaintext highlighter-rouge">A0-A15</code>,Data: <code class="language-plaintext highlighter-rouge">D0-D15</code>. and System: <code class="language-plaintext highlighter-rouge">PCXI.PSW,PC</code>, the System registers are considered special function registers. For this post, we will not dive into architecture specifics as we are just setting up tools and toolchains, for those of you interested in some <em>very</em> dry reading, please see <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=9&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwiWyajMpZDkAhURtlkKHZCBCc4QFjAIegQICBAC&amp;url=https%3A%2F%2Fwww.infineon.com%2Fdgdl%2FTC1_3_ArchOverview_1.pdf%3FfileId%3Ddb3a304312bae05f0112be86204c0111&amp;usg=AOvVaw31AVABjRglbAz7n-awJ8vU">this PDF!</a></p><h2 id="setting-up-the-tricore-toolchain-under-wine">Setting up the Tricore toolchain under WINE</h2><p>Unzip the toolchain</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>unzip free_tricore_entry_tool_chain.zip
</pre></table></code></div></div><p>Run <code class="language-plaintext highlighter-rouge">Setup.exe</code> with WINE:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wine Setup.exe
</pre></table></code></div></div><p>Next click through the install as seen below</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/TRICORE_1.png" alt="Tricore Install" /></p><p>Once the installation has finished, you will find the files we care about in the resulting directory:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>~/.wine/drive_c/HIGHTEC/toolchains/tricore/v4.9.1.0-infineon-2.0/bin
</pre></table></code></div></div><p>You can add this to your path with the following:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>export PATH=$PATH:~/.wine/drive_c/HIGHTEC/toolchains/tricore/v4.9.1.0-infineon-2.0/bin
</pre></table></code></div></div><p>Now try invoking the gcc compiler with <code class="language-plaintext highlighter-rouge">wine</code> as seen below:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>wrongbaud@wubuntu:~$ wine tricore-gcc.exe
tricore-gcc.exe: fatal error: no input files
compilation terminated.
</pre></table></code></div></div><p>Great! So now lets right some simple code to toggle a GPIO line!</p><h2 id="build-a-hello-world-binary-to-toggle-a-gpio-line">Build a “Hello World” binary to toggle a GPIO line</h2><p>Lets start with a simple main.c that will (according to our datasheet) initialize and toggle a GPIO line!</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre>/*
 * main.c
 *  Created on: Mar 6, 2019
 *      Author: wrongbaud
 */

#include &lt;tc1767.h&gt;
#include &lt;tc1767/scu/addr.h&gt;
#include &lt;tc1767/scu/types.h&gt;
#include &lt;tc1767/port5-struct.h&gt;

typedef struct
{
	unsigned int _con0;
	unsigned int _con1;
}WdtCon_t;

void disable_gpios()
{
	unsigned int * GPIO_CTRL_REG = 0xF0000F1C;
	unsigned int * GPIO_OUTPUT_REG = 0xF0000F04;
	*GPIO_CTRL_REG = 0x80208020;
	*GPIO_OUTPUT_REG = 0x00000000;
}
void toggle_pin_15()
{
	unsigned int * GPIO_CTRL_REG = 0xF0000F1C;
	unsigned int * GPIO_OUTPUT_REG = 0xF0000F04;
	*GPIO_CTRL_REG = 0x80208020;
	*GPIO_OUTPUT_REG = 0x80008000;
}

void main()
{
    // Configure WDT and ENDINT as described in user manual
	unsigned int wcon0,wcon1;
	volatile WdtCon_t *wdtaddr = 0xF00005F0;
	wcon0 = wdtaddr-&gt;_con0;
	wcon1 = wdtaddr-&gt;_con1;
	// Unlock WDT and disable ENDINT protection so we can reconfigure clocks
	wcon0 &amp;= 0xffffff03;
	wcon0 |= 0xf0;
	wcon0 |= (wcon1 &amp; 0xc);
	wcon0 ^= 0x2;
	wdtaddr-&gt;_con0 = wcon0;
	wcon0 &amp;= 0xfffffff0;
	wcon0 |= 0x2;
	wdtaddr-&gt;_con0 = wcon0;
	(void) wdtaddr-&gt;_con0;
	// Reconfigure clock speed as reccomended in user manual
	SCU_PLLCON0_t * SCU_PLLCON0 = (SCU_PLLCON0_t*) SCU_PLLCON0_ADDR;
	SCU_PLLCON0-&gt;bits.VCOBYP = 0;
	SCU_PLLCON1_t * SCU_PLLCON1 = (SCU_PLLCON1_t *) SCU_PLLCON1_ADDR;
	SCU_PLLCON1-&gt;bits.K1DIV = 0;
	toggle_pin_15();
	return 0x1337
}
</pre></table></code></div></div><p>Next, we’ll try to compile this code as follows:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wine ~/.wine/drive_c/HIGHTEC/toolchains/tricore/v4.9.1.0-infineon-2.0/bin/tricore-gcc.exe main.c
</pre></table></code></div></div><p>Oh no! The first big misstep in our journey has appeared!</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>wrongbaud@wubuntu:~/blog/tricore$ wine tricore-gcc.exe hello.c
license check: Can't read license data (-102)
No such file or directory (errno: 2)
license check: No valid license!
hello.c:1:0: error: error in licenser

 ^
hello.c:1:0: error: license check failed
</pre></table></code></div></div><p>Remember the License file we needed earlier? It looks like wine / tricore-gcc.exe can’t find it. After a fair amount of time digging through docs, and troubleshooting wine, I loaded the tricore-gcc.exe in IDA and found out that there was a crucial argument not displayed when you run <code class="language-plaintext highlighter-rouge">tricore-gcc.exe --help</code> …</p><p>The argument <code class="language-plaintext highlighter-rouge">-mlicense-key=dir</code> can be used to specify a directory containing the license file, so lets copy that into our working directory and run the following…</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wine ~/.wine/drive_c/HIGHTEC/toolchains/tricore/v4.9.1.0-infineon-2.0/bin/tricore-gcc.exe hello.c -mlicense-dir=$(pwd) 
</pre></table></code></div></div><p>And we have a resulting <code class="language-plaintext highlighter-rouge">a.out</code> in our directory!</p><p>Most of my experience with the Tricore Architecture is in the realm of reverse engineering. Up until recently, only IDA Pro could be used to disassembly Tricore binary files, however recently github user <a href="https://github.com/mumbel">mumbel</a> recently submitted a Tricore processor module to Ghidra! We will spend the second part of this post building the latest version of Ghidra and checking out this new processor module.</p><h3 id="building--installing-ghidra">Building / Installing GHIDRA</h3><p>In case you’ve not installed it yet, pull down the latest version of GHIDRA from: <a href="https://github.com/NationalSecurityAgency/ghidra">github</a></p><p>Since we are targeting a Tricore processor, you will need to build the latest version of GHIDRA yourself,but <a href="https://github.com/dukebarman">dukebarman</a> has made a very useful docker container for doing so!</p><p>You can use the following docker container to build the latest version of GHIDRA: https://github.com/dukebarman/ghidra-builder</p><p>I have fork <a href="https://github.com/wrongbaud/ghidra-builder">here</a> as well, which addresses and error I ran into when trying to build GHIDRA the first time</p><p>To build GHIDRA using dukebarman’s docker container do the following (this is also in the README):</p><ol><li>Clone the repository: <code class="language-plaintext highlighter-rouge">git clone https://github.com/dukebarman/ghidra-builder</code><li>Enter the directory <code class="language-plaintext highlighter-rouge">cd ghidra-builder</code><li>Build the Docker container: <code class="language-plaintext highlighter-rouge">sudo docker-tpl/build</code><li>Build ghidra: <code class="language-plaintext highlighter-rouge">cd workdir; sudo ../docker-tpl/run ./build_ghidra.sh</code></ol><p>Once this script finishes, there will be a zip file in the <code class="language-plaintext highlighter-rouge">out</code> folder, unzip that to get your freshly built GHIDRA!</p><h3 id="loading-the-resulting-binary-in-ghidra">Loading the resulting binary in GHIDRA</h3><p>Launch your recently built ghidra as follows (change the paths to match your system):</p><p><code class="language-plaintext highlighter-rouge">./blog/ghidra-builder/workdir/out/ghidra_9.1_DEV/ghidraRun</code></p><p>You will see this window asking you to create a project, here I’m making one called <code class="language-plaintext highlighter-rouge">blog</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/GHIDRA_1.png" alt="GHIDRA_1.png" /></p><p>Next we select the project location, choose anywhere you’d like</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/GHIDRA_2.png" alt="GHIDRA_2.png" /></p><p>Finally click on the green dragon button at the top left window to open Ghidra</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/GHIDRA_4.png" alt="GHIDRA_4.png" /></p><p>After that you’ll see a window that looks something like this</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/GHIDRA_3.png" alt="GHIDRA_3.png" /></p><p>Now go to File –&gt; Import File</p><p>Select the binary that we just generated</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/SELECT_TRICORE.png" alt="SELECT_TRICORE.png" /></p><p>After selecting the binary a new options window will appear, under the <code class="language-plaintext highlighter-rouge">Language</code> option click on the three dots to open the language options</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/TRICORE_OPTIONS.png" alt="TRICORE_OPTIONS.png" /></p><p>Select the <code class="language-plaintext highlighter-rouge">TC176X</code> option since we are targeting a TC1767 CPU, click OK. When asked to analyze, click Yes and click Analyze on the following window. You can also close the <code class="language-plaintext highlighter-rouge">Import Results Summary</code> window as well.</p><p>Once the binary has been loaded, you’ll probably that some of the functions generated by the compiler are not initially recognized and disassembled.</p><p>Press <code class="language-plaintext highlighter-rouge">G</code> and enter the address <code class="language-plaintext highlighter-rouge">0x800000AC</code> you should see something similar to below:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/NO_FUNC.png" alt="NO_FUNC.png" /></p><p>For whatever reason, the autoanalysis stopped disassembling here, pressing ‘'’d’’’ at address <code class="language-plaintext highlighter-rouge">0x800000B0</code> will disassemble code there. The first time we do this, we disassemble the following instruction: <code class="language-plaintext highlighter-rouge">jl __init_csa</code> for those of you who are unfamiliar with the Tricore Architecture, this function initializes what is called the “Context Save Area” which is critical for performing call instructions as this is the region of memory that stores the context for functions when they are called. After this function we see a few more <code class="language-plaintext highlighter-rouge">jl</code> calls that were inserted by our toolchain, eventually we see a jump to <code class="language-plaintext highlighter-rouge">main</code>!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/FUNC.png" alt="FUNC.png" /></p><p>Clicking on <code class="language-plaintext highlighter-rouge">main</code> takes us to the following window displaying the code we wrote earlier!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/GHIDRA_CODE.png" alt="GHIDRA_CODE.png" /></p><p>Looks pretty similar to what we wrote before!</p><h2 id="conclusion">Conclusion</h2><p>With this post, we’ve set up a toolchain for Tricore CPUs under Linux, using this toolchain we wrote a very simple C program to toggle GPIO lines. We also built the latest version of Ghidra using a docker container. Lastly we disassembled and decompiled a target binary using Ghidra!</p><h3 id="helpful-links">Helpful Links</h3><ul><li>Tricore Example Code / Loaders (will be useful for later posts)<ul><li><a href="http://www.infineon-autoeco.com/BBS/Detail/6835">http://www.infineon-autoeco.com/BBS/Detail/6835</a><li><a href="http://bbs.21ic.com/archiver/tid-148660.html">http://bbs.21ic.com/archiver/tid-148660.html</a><li><a href="https://github.com/w01230/inf_tc1791_bootloader">https://github.com/w01230/inf_tc1791_bootloader</a></ul></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tools/'>tools</a>, <a href='/categories/automotive/'>automotive</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tools/" class="post-tag no-text-decoration" >tools</a> <a href="/tags/tricore/" class="post-tag no-text-decoration" >tricore</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Tricore Basics: Using the Hightec Tricore Toolchain in Linux - Wrongbaud's Blog&url=https://wrongbaud.github.io/posts/hightec-tricore-linux-ghidra/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Tricore Basics: Using the Hightec Tricore Toolchain in Linux - Wrongbaud's Blog&u=https://wrongbaud.github.io/posts/hightec-tricore-linux-ghidra/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Tricore Basics: Using the Hightec Tricore Toolchain in Linux - Wrongbaud's Blog&url=https://wrongbaud.github.io/posts/hightec-tricore-linux-ghidra/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ghidra-debugger/">A first look at Ghidra's Debugger - Game Boy Advance Edition</a><li><a href="/posts/Holiday-Teardown/">BasicFUN Series Part 4: I2C Sniffing, EEPROM Extraction and Parallel Flash Extraction</a><li><a href="/posts/BasicFUN-rom-analysis/">BasicFUN Series Part 2: Reverse Engineering Firmware / Reflashing SPI Flash</a><li><a href="/posts/MK-Teardown/">BasicFUN Series Part 3: Dumping Parallel Flash via I2C I/O Expanders</a><li><a href="/posts/stm-xbox-jtag/">Hardware Debugging for Reverse Engineers Part 1: SWD, OpenOCD and Xbox One Controllers</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/spi/">spi</a> <a class="post-tag" href="/tags/ghidra/">ghidra</a> <a class="post-tag" href="/tags/tools/">tools</a> <a class="post-tag" href="/tags/i2c/">i2c</a> <a class="post-tag" href="/tags/nand/">nand</a> <a class="post-tag" href="/tags/nes/">nes</a> <a class="post-tag" href="/tags/gba/">gba</a> <a class="post-tag" href="/tags/jtag/">jtag</a> <a class="post-tag" href="/tags/linux/">linux</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/writing-a-ghidra-loader/"><div class="card-body"> <span class="timeago small" > Feb 21, 2020 <i class="unloaded">2020-02-21T08:22:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Writing a GHIDRA Loader: STM32 Edition.</h3><div class="text-muted small"><p> Background In my last post, we managed to dump the firmware off of an Xbox One controller by using the Single Wire Debug interface. Now that we have the firmware image as well as the target CPU de...</p></div></div></a></div><div class="card"> <a href="/posts/Using-Buildroot-for-Reverse-Engineering/"><div class="card-body"> <span class="timeago small" > Sep 28, 2019 <i class="unloaded">2019-09-28T08:06:31+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using Buildroot for Reverse Engineering</h3><div class="text-muted small"><p> Using Buildroot for Reverse Engineering Overview When reverse engineering an embedded system that is Linux based, one often wishes that they had an examplar system that could be virtualized, if o...</p></div></div></a></div><div class="card"> <a href="/posts/ghidra-debugger/"><div class="card-body"> <span class="timeago small" > Dec 19, 2020 <i class="unloaded">2020-12-19T08:06:31+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A first look at Ghidra's Debugger - Game Boy Advance Edition</h3><div class="text-muted small"><p> A first look at Ghidra’s Debugger - Game Boy Advance Edition Overview Yesterday the NSA Twitter account announced that a new branch of Ghidra has been release with the long-awaited debugging capa...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/BasicFUN-rom-analysis/" class="btn btn-outline-primary"><p>BasicFUN Series Part 2: Reverse Engineering Firmware / Reflashing SPI Flash</p></a> <a href="/posts/Using-Buildroot-for-Reverse-Engineering/" class="btn btn-outline-primary"><p>Using Buildroot for Reverse Engineering</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/wrongbaud">wrongbaud</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/spi/">spi</a> <a class="post-tag" href="/tags/ghidra/">ghidra</a> <a class="post-tag" href="/tags/tools/">tools</a> <a class="post-tag" href="/tags/i2c/">i2c</a> <a class="post-tag" href="/tags/nand/">nand</a> <a class="post-tag" href="/tags/nes/">nes</a> <a class="post-tag" href="/tags/gba/">gba</a> <a class="post-tag" href="/tags/jtag/">jtag</a> <a class="post-tag" href="/tags/linux/">linux</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://wrongbaud.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script>
